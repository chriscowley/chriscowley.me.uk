<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: linux | Just Another Linux Blog]]></title>
  <link href="http://http://warm-sword-7449.herokuapp.com//blog/categories/linux/atom.xml" rel="self"/>
  <link href="http://http://warm-sword-7449.herokuapp.com//"/>
  <updated>2012-11-19T21:30:14+01:00</updated>
  <id>http://http://warm-sword-7449.herokuapp.com//</id>
  <author>
    <name><![CDATA[Chris Cowley]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[SFTP Chroot on CentOS]]></title>
    <link href="http://http://warm-sword-7449.herokuapp.com//blog/2012/11/19/sftp-chroot-on-centos/"/>
    <updated>2012-11-19T19:59:00+01:00</updated>
    <id>http://http://warm-sword-7449.herokuapp.com//blog/2012/11/19/sftp-chroot-on-centos</id>
    <content type="html"><![CDATA[<p>This came up today where I needed to give secure file transfer to customers. To complicate things I had to use an out-of-the-box RHEL6 system. The obvious answer was to use SSH and limit those users to SFTP only. Locking them into a chroot was not a requirement, but it seemed like a good idea to me. I found plenty of docs that got 80% of the way, or took a shortcut, but this should be complete.</p>

<!-- more -->


<p>The basic steps are:</p>

<ol>
<li>Create a group and the users to that group</li>
<li>Modify the SSH daemon configuration to limit a group to sftp only</li>
<li>Setup file system permissions</li>
<li>Configure SELinux</li>
<li>Test (of course)</li>
</ol>


<p>Without further ado, lets get started. It should only take about 10 minutes, nothing here is especially complex.</p>

<p>Create a group that is limited to SFTP only and a user to be in that group.</p>

<p><code>
groupadd sftponly
useradd sftptest
usermod -aG sftponly  sftptest
</code></p>

<p>Now you need to make a little change to <code>/etc/ssh/sshd_config</code>. There will be a <em>Subsystem</em> line for <code>sftp</code> which you need to change to read:</p>

<p><code>
Subsystem       sftp    internal-sftp
</code></p>

<p>Now you need to create a block at the end to limit members of a group (ie the sftponly group you created above) and chroot them. Simply add the following to the end of the file:</p>

<p>```
Match Group sftponly</p>

<pre><code>ChrootDirectory %h
ForceCommand internal-sftp
X11Forwarding no
AllowTcpForwarding no
</code></pre>

<p>```</p>

<p>These changes will require a reload of the SSH daemon: <code>service sshd reload</code></p>

<p>Now you need to make some file permission changes. For some reason which I cannot work out for now, the home directory must be owned by root and have the permissions 755. So we will also need to make a folder in the home directory to upload to and make that owned by the user.</p>

<p><code>
sudo -u sftptest mkdir -pv /home/sftptest/upload
chown root. /home/sftptest
chmod 755 /home/sftptest
chgrp -R sftponly /home/sftptest
</code></p>

<p>The last thing we need to do is tell SELinux that we want to upload files via SFTP to a chroot as it is read-only by default. Of course you are running SELinux in enforcing mode aren't you :)</p>

<p><code>
setsebool -P ssh_chroot_rw_homedirs on
</code></p>

<p>Now from another console you can sftp to your server</p>

<p><code>
sftp sftptest@&lt;server&gt;
</code></p>

<p>You should then be able to put a file in your upload folder. However if you try to ssh to the server as the user <em>sftptest</em> it should tell you to go away. Of course you should be able to <em>ssh</em> as your normal user with no problem. Pro tip: make sure to leave a root terminal open just in case.</p>

<p>Required reading:</p>

<ul>
<li><a href="http://wiki.centos.org/HowTos/SELinux">CentOS Wiki SELinux</a></li>
<li><a href="http://wiki.centos.org/TipsAndTricks/SelinuxBooleans">CentOS Wiki SELinuxBooleans</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[I have a Raspberry Pi]]></title>
    <link href="http://http://warm-sword-7449.herokuapp.com//blog/2012/08/04/i-have-a-raspberry-pi/"/>
    <updated>2012-08-04T21:47:00+02:00</updated>
    <id>http://http://warm-sword-7449.herokuapp.com//blog/2012/08/04/i-have-a-raspberry-pi</id>
    <content type="html"><![CDATA[<p>Just got my new toy! I have to admit that I am not completely certain what I will do with it yet though.</p>

<!-- more -->


<p>It will certainly start by running <a href="http://mpd.wikia.com/wiki/Music_Player_Daemon_Wiki" target="_blank">Music Player Daemon</a>.</p>

<p><a href="http://www.flickr.com/photos/chriscowleyunix/7705281518/" title="Raspberry Pi by chriscowleysound, on Flickr"><img src="http://farm9.staticflickr.com/8023/7705281518_73c2ee8c18.jpg" width="500" height="375" alt="Raspberry Pi"></a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Installing PostgreSQL on Fedora 17]]></title>
    <link href="http://http://warm-sword-7449.herokuapp.com//blog/2012/06/23/installing-postgresql-on-fedora-17/"/>
    <updated>2012-06-23T13:02:00+02:00</updated>
    <id>http://http://warm-sword-7449.herokuapp.com//blog/2012/06/23/installing-postgresql-on-fedora-17</id>
    <content type="html"><![CDATA[<p>With the new systemd this now requires a couple of manual steps.</p>

<p>Obviously we start by installing the RPMS themselves:</p>

<!-- more -->


<p><code>
sudo yum install postgresql-server postgresql
</code></p>

<p>If you were to now try and start the server it would fail as there is no database. The old SysV init script had an <em>initdb</em> option, but this no longer exists in the systemd service script. This means that you need to initialise the database manually:
<code>
sudo -u postrgres initdb -D /var/lib/pgsql/
</code></p>

<p>You can now start the service and enable it permanently
<code>
sudo service postgresql start
sudo chkconfig postgresql on
</code></p>

<p>Now you can enter the database as the postgres <em>superuser</em>:
<code>
sudo -u postgres psql -d postgres
</code>
Finally create your user and associated database
<code>
CREATE ROLE "testAdmin" LOGIN PASSWORD 'testAdmin';
CREATE DATABASE "testDB" WITH ENCODING='UTF8' OWNER="testAdmin";
\q
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Skype video on Fedora 64bit]]></title>
    <link href="http://http://warm-sword-7449.herokuapp.com//blog/2012/04/18/skype-video-on-fedora-64bit/"/>
    <updated>2012-04-18T15:53:00+02:00</updated>
    <id>http://http://warm-sword-7449.herokuapp.com//blog/2012/04/18/skype-video-on-fedora-64bit</id>
    <content type="html"><![CDATA[<p>Install Skype â€“ I used <a href="http://slayachronicles.blogspot.co.uk/2012/03/installing-skype-on-fedora-16-64-bit.html" target="_blank" >these</a> instructions. This will seem to get everything working, but video will just give you a black screen and no error message. This is because Skype is 32 bit and you webcam driver is 64 bit. Make sure you have libv4l.i686 installed.</p>

<!-- more -->


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo yum install libv4l.i686</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Now create a wrapper script to launch it with a custom environment. I put it in <em>/usr/local/bin/skype</em></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span> (skype)</span> <a href='/downloads/code/skype'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="nv">LD_PRELOAD</span><span class="o">=</span>/usr/lib/libv4l/v4l1compat.so  /usr/bin/skype
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>This will now get loaded before the main Skype executable and you will have a working video device.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu upgrade problems]]></title>
    <link href="http://http://warm-sword-7449.herokuapp.com//blog/2011/10/16/ubuntu-upgrade-problems/"/>
    <updated>2011-10-16T13:24:00+02:00</updated>
    <id>http://http://warm-sword-7449.herokuapp.com//blog/2011/10/16/ubuntu-upgrade-problems</id>
    <content type="html"><![CDATA[<p>Usually the release upgrade is relatively trouble-free, but this time I had a minor problem. After the upgrade I had no X Windows. It turned out that the NVidia driver not loading.</p>

<p>I had to boot it up in rescue mode, which is selectable from the Grub menu. From there I could drop to a root console.</p>

<!-- more -->


<p>The first step is to remount / as read-write and then mount my boot partition (/dev/sda1).
<code>
mount -o rw,remount /
mount /dev/sda1 /boot
</code>
Now I just need to move the xorg.conf to one side and reinstall the nvidia driver
<code>
mv /etc/X11/xorg.conf /etc/X11/xorg.conf.bak
apt-get remove nvidia-current &amp;&amp; apt-get install nvidia-current
</code>
After a reboot it should come up all fine and dandy.</p>
]]></content>
  </entry>
  
</feed>
